document.addEventListener("DOMContentLoaded",(()=>{let e=JSON.parse(sessionStorage.getItem("userData"))||{},t={element:null,val:null,edited:!1},o=!1,n="true"===sessionStorage.getItem("isDownloaded"),l="true"===sessionStorage.getItem("isTrueDownloaded"),a="true"===sessionStorage.getItem("isTruesDownloaded");const r=document.querySelectorAll("main section"),s=r[0],i=s.querySelector("button"),c=document.querySelector(".photo-user-name h3"),u=document.querySelector(".photo-user-name p");c.textContent=e.Name||"John Doe",u.textContent=Array.isArray(e.Skills)&&e.Skills.length?e.Skills[0]:"Painter";const d=s.querySelector(".photo-user .photo-holder img"),m=document.querySelector("header button");e.UserImage&&"No Image"!==e.UserImage?(d.src=e.UserImage,o=!0):(d.src="logo.png",o=!1),m.disabled=!o,document.querySelectorAll("main section").forEach((t=>{if(t!==s){t.querySelectorAll("div ul li").forEach((t=>{const o=t.getAttribute("data-label");e[o]&&(t.textContent=Array.isArray(e[o])?e[o].join(", "):e[o],t.classList.add("edited"))}))}})),p(),i.onclick=function(){h()},r.forEach((o=>{if(o!==s){o.querySelectorAll("div ul li").forEach((o=>{o.onclick=function(){const n=o.getAttribute("data-label"),l=o.getAttribute("data-type-input"),a=o.getAttribute("data-required");t.element=o,t.val=o.textContent.trim(),function(t,o,n,l,a){if("single"===l){const l=document.querySelector(".input-overlay"),r=l.querySelector(".input-close"),s=l.querySelector(".input-content .controls-inputs input"),i=l.querySelector(".input-content .controls-inputs button"),c=l.querySelector(".input-content h3");s.placeholder="Add "+o,s.type=n,setTimeout((()=>s.focus()),100),s.value=e[o]?e[o]:"",c.textContent=`(${o}) `+a.val,l.style.display="flex",s.oninput=function(){i.disabled=""===s.value.trim()||s.value.trim()===a.val},i.onclick=function(){t.textContent=s.value.trim(),i.disabled=!0,a.edited=!0,a.val=t.textContent,a.element.classList.add("edited"),e[o]=a.val,sessionStorage.setItem("userData",JSON.stringify(e)),l.style.display="none",i.disabled=!0,s.value="",p()},r.onclick=function(){l.style.display="none",i.disabled=!0,""!==s.value.trim()&&s.value.trim()===a.val&&a.element.classList.toggle("edited",!0),p(),s.value=""}}if("multiple"===l){const a=document.querySelector(".overlay-multiple-inputs"),r=a.querySelector(".multiple-close"),s=a.querySelector(".multiple-content h3"),i=document.querySelector(".multiple-content p span"),c=document.querySelector(".multiple-content p button"),u=document.querySelector(".multiple-content input"),d=document.querySelector(".multiple-content .list-multiples ul");s.textContent=`You can add ${l} ${o}`,i.textContent=o,u.placeholder=`Write your ${o}(s) here...`,setTimeout((()=>u.focus()),100),u.type=n,y=[...new Set(e[o]||[])],d.innerHTML="",d.dataset.currentLabel=o;const m=e=>{y.includes(e)||y.push(e);const t=document.createElement("li");t.innerHTML=`\n                    <div class="textcontent"><span>${e}</span></div>\n                    <div class="delete-text"><span>&times;</span></div>`,d.appendChild(t),t.querySelector(".delete-text").onclick=()=>{h(e,t)},c.disabled=0===d.children.length},h=(e,t)=>{y=y.filter((t=>t!==e)),t.remove(),c.disabled=0===d.children.length};y.forEach((e=>m(e))),a.style.display="flex",u.addEventListener("keydown",(e=>{if("#"===e.key&&""!==u.value.trim()){e.preventDefault();const t=u.value.trim().replace(",","");m(t),u.value=""}})),r.onclick=function(){a.style.display="none",u.value="",c.disabled=!0,p()},c.onclick=function(){e[o]=[...new Set(y)],t.classList.add("edited"),t.textContent=e[o].join(", "),sessionStorage.setItem("userData",JSON.stringify(e)),a.style.display="none",u.value="",c.disabled=!0,p()}}}(o,n,l,a,t)}}))}}));let y=[];function p(){const t=document.querySelector("header button"),n=s.querySelector(".photo-user-name h3"),l=s.querySelector(".photo-user-name p");let a=!0;r.forEach((e=>{if(e!==s){const t=e.querySelectorAll("div ul li");Array.from(t).every((e=>e.classList.contains("edited")))||(a=!1)}})),!o&&a&&(document.documentElement.scrollTop=0,i.classList.add("highlighted"),setTimeout((function(){i.classList.remove("highlighted")})),h()),t.disabled=!(a&&o),n.textContent=e.Name?e.Name:"John Doe",l.textContent=Array.isArray(e.Skills)&&e.Skills.length?e.Skills[0]:"Painter"}function h(){const t=document.querySelector(".overlay-image-display"),n=t.querySelector(".overlay-img-close"),l=t.querySelector(".overlay-img-content .top #FileInput"),a=t.querySelector(".overlay-img-content .center"),r=a.querySelector("img"),i=t.querySelector(".overlay-img-content .bottom button"),c=s.querySelector(".photo-user .photo-holder img"),u=s.querySelector(".photo-user-name h3");t.style.display="flex";let d=null,m=null;l.onchange=function(){const e=l.files[0];if(i.disabled=!e,a.style.display=e?"block":"none",r.src=e?URL.createObjectURL(e):"",d=e?URL.createObjectURL(e):null,imageFile=e||null,!e||!e.type.startsWith("image/"))return void alert("Please select a valid image.");const t=new FileReader;t.onloadend=function(){m=t.result},t.readAsDataURL(e)},n.onclick=function(){a.style.display="none",i.disabled=!0,URL.revokeObjectURL(d),r.src="",l.value="",t.style.display="none",u.textContent=e.Name?e.Name:"John Doe",p()},i.onclick=function(){c.src=URL.createObjectURL(l.files[0]),o=!0,e.UserImage=m||"No Image",sessionStorage.setItem("userData",JSON.stringify(e)),URL.revokeObjectURL(d),u.textContent=e.Name?e.Name:"John Doe",a.style.display="none",i.disabled=!0,r.src="",l.value="",t.style.display="none",p()}}m.onclick=function(){!function(){const t=document.querySelector(".overlay-choice-templates"),o=t.querySelector(".templates-choice-close"),r=t.querySelector("ul");t.style.display="flex",r.querySelectorAll("li").forEach(((o,r)=>{o.addEventListener("click",(function(){0===r?function(){const e=document.querySelectorAll(".overlay-templates .tepmlates")[0],t=e.querySelectorAll("div"),o=e.querySelectorAll(".button button")[0],n=e.querySelectorAll(".button button")[1];document.querySelectorAll(".overlay-templates .tepmlates").forEach((t=>{t!==e&&(t.style.display="none")})),document.querySelector(".overlay-templates").style.display="flex",t.forEach((e=>{e.querySelectorAll("p span").forEach((e=>{f(e)}))})),o.disabled=l,n.disabled=a,o.onclick=function(){S(e,"PDF"),o.disabled=!0,sessionStorage.setItem("isTrueDownloaded","true")},n.onclick=function(){S(e,"Text"),n.disabled=!0,l=!0,sessionStorage.setItem("isTruesDownloaded","true")},n.disabled=l}():function(){const t=document.querySelectorAll(".overlay-templates .tepmlates")[1],o=t.querySelector(".image-cv .photo img"),l=t.querySelectorAll(".template-content"),a=t.querySelector(".button button");document.querySelectorAll(".overlay-templates .tepmlates").forEach((e=>{e!==t&&(e.style.display="none")})),o.src=e?e.UserImage:"logo.png",l.forEach((e=>{e.querySelectorAll("p span").forEach((e=>{f(e)}))})),document.querySelector(".overlay-templates").style.display="flex",a.disabled=n,a.onclick=()=>{a.disabled=!0,async function(t){const o=t.cloneNode(!0);o.querySelectorAll(".button").forEach((e=>e.remove()));const n=o.querySelector("img");let l=null;if(n){const e=n.src;try{l=await(a=e,new Promise(((e,t)=>{const o=new Image;o.setAttribute("crossOrigin","anonymous"),o.onload=()=>{const t=document.createElement("canvas");t.width=o.width,t.height=o.height,t.getContext("2d").drawImage(o,0,0);const n=t.toDataURL("image/png");e(n)},o.onerror=e=>{t(e)},o.src=a})))}catch(e){console.error("Error converting image:",e)}}var a;const{jsPDF:r}=window.jspdf,s=new r;let i=10;l&&(s.addImage(l,"PNG",20,i,50,50),i+=60);s.setFont("helvetica","bold"),s.setFontSize(16),s.text("Curriculum Vitae",105,i,{align:"center"});const c=s.getTextWidth("Curriculum Vitae");s.line(105-c/2,i+2,105+c/2,i+2),i+=20;const u=o.querySelectorAll("h2, p"),d=(e,t,o=10)=>t+o>e.internal.pageSize.height?(e.addPage(),20):t;u.forEach((e=>{if("H2"===e.tagName)i=d(s,i,20),s.setFont("helvetica","bold"),s.setFontSize(18),i+=10,s.text(e.textContent.trim(),20,i),i+=8;else if("P"===e.tagName){i=d(s,i,20),s.setFont("helvetica","normal"),s.setFontSize(14);let t=20;e.childNodes.forEach((e=>{e.nodeType===Node.TEXT_NODE?s.setFont("helvetica","normal"):"STRONG"===e.tagName&&s.setFont("helvetica","bold");s.splitTextToSize(e.textContent.trim(),170).forEach((e=>{i=d(s,i,6),s.text(e,t,i),i+=6})),s.setFont("helvetica","normal")})),i+=6}})),setTimeout((()=>{s.save(`${e?e.Name:"New"}_CV.pdf`),v("Your CV has been successfully downloaded as a PDF!")}),100)}(t),n=!0,sessionStorage.setItem("isDownloaded","true")}}(),t.style.display="none"}))})),o.onclick=()=>{t.style.display="none"}}()};const f=t=>{const o=t.className;if(e&&e.hasOwnProperty(o)){let n=e[o];Array.isArray(n)?n=n.map((e=>"none"===e?"Not available for the moment":e)):"none"===n&&(n="Not available for the moment"),t.textContent=Array.isArray(n)?n.join(", "):n}};function S(t,o){const n=t.cloneNode(!0);if(n.querySelectorAll(".button").forEach((e=>e.remove())),"PDF"===o){const{jsPDF:t}=window.jspdf,o=new t({orientation:"portrait",unit:"mm",format:"a4"});let l=26;o.setFont("helvetica","bold"),o.setFontSize(16),o.text("Curriculum Vitae",105,l,{align:"center"});const a=o.getTextWidth("Curriculum Vitae");o.line(105-a/2,l+2,105+a/2,l+2),l+=20;n.querySelectorAll("h2, p").forEach((e=>{if("H2"===e.tagName)o.setFont("helvetica","bold"),o.setFontSize(18),l+=10,o.text(e.textContent.trim(),20,l),l+=8;else if("P"===e.tagName){o.setFont("helvetica","normal"),o.setFontSize(14);let t=20;e.childNodes.forEach((e=>{e.nodeType===Node.TEXT_NODE?o.setFont("helvetica","normal"):"STRONG"===e.tagName&&o.setFont("helvetica","bold");o.splitTextToSize(e.textContent.trim(),170).forEach((e=>{l+10>o.internal.pageSize.height&&(o.addPage(),l=20),o.text(e,t,l),l+=6})),o.setFont("helvetica","normal")})),l+=6}}));const r=`${e?e.Name:"New"}_CV.pdf`;setTimeout((()=>{o.save(r),v("Your CV has been successfully downloaded as a PDF!")}),100)}else if("Text"===o){const t=n.textContent.trim(),o=new Blob([t],{type:"text/plain"}),l=document.createElement("a");l.href=URL.createObjectURL(o),l.download=`${e?e.Name:"New"}_CV.txt`,l.click(),v("Your CV has been successfully downloaded as a text file!")}}function v(e){document.querySelector(".success-overlay").style.display="flex",document.querySelector(".success-overlay h2").textContent=e,setTimeout((function(){document.querySelector(".success-overlay").style.display="none"}),5e3)}document.querySelector(".overlay-templates .templates-close").onclick=function(){document.querySelectorAll(".overlay-templates .tepmlates").forEach((e=>{e.style.display="block"})),this.parentElement.style.display="none"};let g,q="true"===sessionStorage.getItem("verified"),b=7200;q?document.querySelector(".authentication-overlay").style.display="none":async function(){const e=document.querySelector(".authentication-overlay"),t=e.querySelector(".authentication-content .pass-code-input input"),o=e.querySelector(".authentication-content .pass-code-input button"),n=e.querySelector(".authentication-content h4 #Hint");let l=[];const a={1:"I",2:"II",3:"III",4:"IV",5:"V",6:"VI",7:"VII",8:"VIII",9:"IX",10:"X"};try{const e=await fetch("passcode.json");if(!e.ok)throw new Error("Failed to load data");l=await e.json()}catch(e){return void console.error("Failed",e)}l.length>0&&r();function r(){const r=Math.floor(Math.random()*l.length),i=l[r];let c=null;i.PasswordUpperCase&&(c="UpperCase"),i.PasswordLowerCase&&(c="LowerCase");const u=i.PasswordList,d=u[Math.floor(Math.random()*u.length)],m=u.findIndex((e=>e===d));n.textContent=`${i.PasswordName} - ${a[m+1]} (${c})`;const y="UpperCase"===c?d.toUpperCase():d.toLowerCase();t.oninput=()=>{o.disabled=""===t.value.trim()},o.onclick=()=>{t.value.trim()===y?(e.style.display="none",q=!0,sessionStorage.setItem("verified","true"),v("Welcome This Session Expires in 2 Hours Already Five Seconds are over"),s()):(e.style.display="flex",q=!1,sessionStorage.setItem("verified","false")),o.disabled=!0,t.value=""}}function s(){g=setInterval((function(){b--,b<=5&&v(`Your session expires in ${b} seconds`),0===b&&(clearInterval(g),sessionStorage.clear(),window.location.reload())}),1e3)}}()}));
